library(raster)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
NOX <- grid_emissions[grid_emissions$Substance == 'NOx',]
mapview(NOX, map.types = c("OpenStreetMap.BlackAndWhite"), zcol = 'Sailing_kg', at = round(getJenksBreaks(NOX$Sailing_kg, 10),0))
rm(NOX)
gps_data <- load('gps/apr1_AIS_decoded.Rdata')
head(gps_Data)
head(gps_data)
class(data)
gps_data <- data
rm(data)
head(gps_data)
library(sp)
coordinates(gps_data) <- ~lon+lat
proj4string(gps_data)  <- CRS(latlong)
plot(head(gps_data))
plot(gps_data)
1+1
new_grid
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
new_grid$sailing_points   <- NA
new_grid
gps_data <- spTransform(gps_data, CRS(ukgrid))
gps_data
gps_grid <- rasterize(gps_data, new_grid, fun='count')
plot(gps_grid)
plot(gps_grid$time)
mapview(gps_grid$time)
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
install.packages("BAMMtools")
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
new_grid$sailing_points   <- NA
load('gps/apr1_AIS_decoded.Rdata')
gps_data <- data
rm(data)
coordinates(gps_data) <- ~lon+lat
proj4string(gps_data)  <- CRS(latlong)
gps_data <- spTransform(gps_data, CRS(ukgrid))
gps_grid <- rasterize(gps_data, new_grid, fun='count')
plot(gps_grid)
gps_Grid
gps_grid
head(gps_data)
gps_grid <- rasterize(gps_data$time, new_grid, fun='count')
gps_grid <- rasterize(gps_data, new_grid, FUN='count')
gps_grid
gps_grid <- rasterize(gps_data, new_grid, fun='count')
names(gps_grid)
names(gps_grid) <- c('id', 'count')
cellStats(gps_grid, summary)
mapview(gps_grid$count)
gps_grid <- rasterize(gps_data, new_grid, fun=function(x,...)length(x))
gps_grid
names(gps_grid) <- c('id', 'count')
mapview(gps_grid$count)
new_grid
new_grid$sailing_points <- NULL
gps_grid <- rasterize(gps_data, new_grid, 1)
gps_grid
gps_data$time <- 1
gps_grid <- rasterize(gps_data, new_grid, fun=sum)
gps_grid
names(gps_grid) <- c('id', 'count')
gps_grid
mapview(gps_grid$count)
cellStats(gps_grid, summary
)
extent(gps_grid)
extent(grid_emissions)
test <- aggregate(gps_grid, fact = 5, fun=sum)
plot(test)
test
sum(test$count)
cellStats(test, sum
)
gps_data <- gps_data[new_grid,]
gps_data <- crop(gps_data, new_grid]
gps_data <- crop(gps_data, new_grid)
load('gps/apr1_AIS_decoded.Rdata')
gps_data <- data
rm(data)
coordinates(gps_data) <- ~lon+lat
proj4string(gps_data)  <- CRS(latlong)
gps_data <- spTransform(gps_data, CRS(ukgrid))
gps_data <- crop(gps_data, new_grid)
gps_data$time <- 1
gps_grid <- rasterize(gps_data, new_grid, fun=sum)
names(gps_grid) <- c('id', 'count')
gps_grid
cellStats(test, sum
)
hundred_grid <- aggregate(gps_grid, fact = 5, fun=sum)
test <- gps_grid / hundred_grid
overlay(gps_grid, hundred_grid)
overlay(gps_grid, hundred_grid, fun = sum
)
overlay(gps_grid, hundred_grid, fun = function(x/y))
overlay(gps_grid, hundred_grid, fun = function(x,y){x/y}
)
overlay(gps_grid$count, hundred_grid$count, function(x,y){x/y}
)
overlay(gps_grid$count, hundred_grid$count, fun = function(x,y){x/y})
hundred_grid$count
cellStats(hundred_grid$count, sum)
disaggregate(hundred_grid, fact = 5, method = '')
grps_grid
gps_grid
plot(hundred_grid)
mapview(hundred_grid)
hundred_grid
hundred_grid <- aggregate(gps_grid, fact = 10, fun=sum)
plot(hundred_grid)
mapview(hundred_grid)
grid_emissions
mapview(grid_emissions)
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700) %>% st_transform(4326)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp') %>% st_set_crs(27700) %>% st_transform(4326)
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
plot(grid_emissions)
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
new_grid$sailing_points   <- NA
plot(new_grid)
new_grid
raster(new_grid)
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
values(new_grid)          <- NA
plot(new_grid)
new_gri
d
new_grid
names(new_grid)
names(new_grid)           <- 'sailing_points'
mapview(new_grid$sailing_points, map.types = c("OpenStreetMap.BlackAndWhite"))
mapview(new_grid, map.types = c("OpenStreetMap.BlackAndWhite"))
load('gps/apr1_AIS_decoded.Rdata')
gps_data <- data
rm(data)
coordinates(gps_data) <- ~lon+lat
coordinates(gps_data) <- ~lon+lat
proj4string(gps_data)  <- CRS(latlong)
gps_data <- spTransform(gps_data, CRS(ukgrid))
gps_data
gps_data <- crop(gps_data, new_grid)
head(gps_data)
gps_data$time <- 1
gps_grid <- rasterize(gps_data, new_grid, fun=sum)
names(gps_grid) <- c('id', 'count')
plot(gps_grid)
plot(gps_grid$count)
gps_grid
hundred_grid <- aggregate(gps_grid, fact = 10, fun=sum)
plot(hundred_grid)
plot(hundred_grid[1:10])
plot(hundred_grid[1:10,])
cellStats(hundred_grid, summary)
cellStats(gps_grid, summary)
cellStats(hundred_grid, sum)
cellStats(gps_grid, sum)
res(hundred_grid)
res(hundred_grid) <- 10
cellStats(hundred_grid, sum)
hundred_grid
hundred_grid <- aggregate(gps_grid, fact = 10, fun=sum)
disaggregate(hundred_grid, fact = 10, fun = NA)
ten_grid <- disaggregate(hundred_grid, fact = 10, fun = NA)
cellStats(ten_grid, sum)
cellStats(ten_grid, sum)$coutn
cellStats(ten_grid, sum)$count
cellStats(ten_grid, sum)[[2]]
cellStats(hundred_grid, sum)
845254*10
845254*10*10
gps_grid / ten_grid
gps_grid
grid_emissions
extent(grid_emissions)
extent(ten_grid)
class(grid_emissions)
gps_grid <- gps_grid / ten_grid
gps_grid
plot(gps_grid$count)
grid_emissions
plot(grid_emissions$AtBerth_kg)
plot(st_geometry(grid_emissions$AtBerth_kg))
plot(st_geometry(grid_emissions))
plot(gps_grid)
plot(gps_grid$count)
plot(st_geometry(grid_emissions), add=T)
emissions
grid
rm(emissions, gps_data, grid, hundred_grid, new_grid, ten_grid)
gps_Grid
gps_grid
names(gps_grid)
names(gps_grid) <- c('id','percent_of_gps_points_in_100m')
head(gps_grid)
cellStats(gps_grid, sum)
cellStats(gps_grid, summary)
grid_emissions
berths
crop(gps_grid, buffer(berths,10))
berths
st_buffer(berths, 10)
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700) %>% st_transform(4326)
berths <- berths[-179,]
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700) %>% st_transform(4326)
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700) %>% st_transform(4326)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp') %>% st_set_crs(27700) %>% st_transform(4326)
mapview(berths, map.types = c("OpenStreetMap.BlackAndWhite")) %>% addFeatures(river)
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
NOX <- grid_emissions[grid_emissions$Substance == 'NOx',]
mapview(NOX, map.types = c("OpenStreetMap.BlackAndWhite"), zcol = 'Sailing_kg', at = round(getJenksBreaks(NOX$Sailing_kg, 10),0))
rm(NOX)
NOX <- grid_emissions[grid_emissions$Substance == 'NOx',]
mapview(NOX, map.types = c("OpenStreetMap.BlackAndWhite"), zcol = 'AtBerth_kg', at = round(getJenksBreaks(NOX$AtBerth_kg, 10),0))
rm(NOX)
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
values(new_grid)          <- NA
names(new_grid)           <- 'sailing_points'
mapview(new_grid, map.types = c("OpenStreetMap.BlackAndWhite"))
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700) %>% st_transform(4326)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp') %>% st_set_crs(27700) %>% st_transform(4326)
mapview(berths, map.types = c("OpenStreetMap.BlackAndWhite")) %>% addFeatures(river)
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
NOX <- grid_emissions[grid_emissions$Substance == 'NOx',]
mapview(NOX, map.types = c("OpenStreetMap.BlackAndWhite"), zcol = 'Sailing_kg', at = round(getJenksBreaks(NOX$Sailing_kg, 10),0))
rm(NOX)
NOX <- grid_emissions[grid_emissions$Substance == 'NOx',]
mapview(NOX, map.types = c("OpenStreetMap.BlackAndWhite"), zcol = 'AtBerth_kg', at = round(getJenksBreaks(NOX$AtBerth_kg, 10),0))
rm(NOX)
new_grid                  <- raster(extent(grid_emissions), res=10, crs = ukgrid)
values(new_grid)          <- NA
names(new_grid)           <- 'sailing_points'
load('gps/apr1_AIS_decoded.Rdata')
gps_data <- data
rm(data)
coordinates(gps_data) <- ~lon+lat
proj4string(gps_data)  <- CRS(latlong)
gps_data <- spTransform(gps_data, CRS(ukgrid))
gps_data <- crop(gps_data, new_grid)
gps_data$time <- 1
gps_grid <- rasterize(gps_data, new_grid, fun=sum)
names(gps_grid) <- c('id', 'count')
gps_grid
gps_data
berths <- st_buffer(berths, 30)
plot(berths[1,])
berths
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700)
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700)
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp') %>% st_set_crs(27700)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp') %>% st_set_crs(27700)
berths <- st_buffer(berths, 30)
plot(berths[1:2,])
mapview(berths[1,])
mapview(berths[10,])
at_berth_gps <- st_crop(gps_data, berths)
gps_data <- st_as_sf(gps_data)
gps_data
at_berth_gps <- st_crop(gps_data, berths)
gps_data <- st_as_sf(gps_data) %>% st_set_crs(27700)
gps_data
at_berth_gps <- st_crop(gps_data, berths)
at_berth_gps
at_berth_gps <- st_difference(gps_data, berths)
at_berth_gps <- st_join(gps_data, berths, join = st_intersects)
head(at_berth_gps)
at_berth_gps[!is.na(at_berth_gps$berth_name),]
gps_data <- st_join(gps_data, berths, join = st_intersects)
rm(at_berth_gps)
mapview(gps_data[!is.na(gps_data$berth_name)])
mapview(gps_data[!is.na(gps_data$berth_name),])
berth_grid        <- rasterize(gps_data[!is.na(gps_data$berth_name),], new_grid, fun=sum)
class(gps_data$time)
berth_grid        <- rasterize(gps_data[!is.na(gps_data$berth_name),1], new_grid, fun=sum)
sailing_grid      <- rasterize(gps_data[is.na(gps_data$berth_name),1], new_grid, fun=sum)
sailing_grid
names(berth_grid)   <- c('id', 'count')
names(sailing_grid) <- c('id', 'count')
berth_hundred_grid   <- aggregate(berth_grid, fact = 10, fun=sum)
sailing_hundred_grid <- aggregate(sailing_grid, fact = 10, fun=sum)
berth_ten_grid     <- disaggregate(berth_hundred_grid, fact = 10, fun = NA)
sailing_ten_grid   <- disaggregate(sailing_hundred_grid, fact = 10, fun = NA)
berth_grid    <- berth_grid   / berth_ten_grid
sailing_grid  <- sailing_grid / sailing_ten_grid
rm(emissions, gps_data, grid, hundred_grid, new_grid, ten_grid)
berth_grid
sailing_grid
names(berth_grid)   <- c('id','percent_of_gps_points_in_100m')
names(sailing_grid) <- c('id','percent_of_gps_points_in_100m')
# rmarkdown::render('river_and_berths.Rmd', encoding = 'html_document', output_dir = "docs")
rm(list=ls(all=TRUE))
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
library(viridis)
library(rasterVis)
library(rgeos)
# rmarkdown::render('river_and_berths.Rmd', encoding = 'html_document', output_dir = "docs")
rm(list=ls(all=TRUE))
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
library(viridis)
library(rasterVis)
library(rgeos)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp', quiet = T) %>% st_set_crs(27700)
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp', quiet = T) %>% st_set_crs(27700)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp', quiet = T) %>% st_set_crs(27700)
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
grid_emissions <- grid_emissions[,c('GRID_ID0', 'Sailing_kg', 'AtBerth_kg', 'Substance')]
grid_emissions = grid_emissions %>%
group_by(GRID_ID0, Substance) %>%
summarise(sailing = sum(Sailing_kg, na.rm = TRUE),
berth = sum(AtBerth_kg, na.rm = TRUE))
grid_emissions
grid_emissions <- grid_emissions[grid_emissions$Substance == 'N2O',]
#Empty raster
r  <- raster(ext =  extent(grid_emissions),
res =  1000,
crs =  ukgrid,
vals = NA)
plot(r)
plot(grid_emissions[grid_emissions$Substance == 'N2O','sailing'], add=T)
grid_emissions
grid_emissions <- as(grid_emissions, 'Spatial')
grid_emissions <- SpatialPointsDataFrame(grid_emissions, grid_emissions@data)
grid_emissions
cellFromXY(r, grid_emissions[grid_emissions$Substance == 'N2O','sailing'])
cell_numbers    <- cellFromXY(r, grid_emissions[grid_emissions$Substance == 'N2O','sailing'])
r[cell_numbers] <- grid_emissions[grid_emissions$Substance == 'N2O','sailing']$sailing
r
plot(r)
names(r) <- 'sailing_no2'
r
mapview(r)
mapview(grid_emissions[grid_emissions$Substance == 'N2O','sailing'])
cell_numbers    <- cellFromXY(r, grid_emissions[grid_emissions$Substance == 'N2O','sailing'], fun=sum)
grid_emissions
plot(grid_emissions)
# rmarkdown::render('river_and_berths.Rmd', encoding = 'html_document', output_dir = "docs")
rm(list=ls(all=TRUE))
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(mapview)
library(leaflet)
library(tidyverse)
library(BAMMtools)
library(raster)
library(sp)
library(viridis)
library(rasterVis)
library(rgeos)
latlong = "+init=epsg:4326"
ukgrid = "+init=epsg:27700"
google = "+init=epsg:3857"
berths <- st_read('X:/Projects/PLA/GIS/Shapefiles/Berths.shp', quiet = T) %>% st_set_crs(27700)
berths <- berths[-179,]
river  <- st_read('X:/Projects/PLA/GIS/Shapefiles/River Thames Outline.shp', quiet = T) %>% st_set_crs(27700)
mapview(berths, map.types = c("OpenStreetMap.BlackAndWhite")) %>% addFeatures(river)
emissions                   <- read_csv('emissions/inventory_export_2016.csv', col_types = cols())
emissions                   <- aggregate(data=emissions, cbind(Sailing_kg, AtBerth_kg) ~ Substance + CellID, FUN=sum)
emissions$CellID            <- as.numeric(emissions$CellID)
grid                        <- st_read('grids/LAEIGridExtensionV2.gpkg', quiet = T)
grid_emissions              <- merge(emissions, grid, by.x = 'CellID', by.y = 'GRID_ID')
st_geometry(grid_emissions) <- grid_emissions$geom
mapview(grid_emissions[grid_emissions$Substance == 'N2O','Sailing_kg'], map.types = c("OpenStreetMap.BlackAndWhite"))
grid_emissions <- grid_emissions[,c('GRID_ID0', 'Sailing_kg', 'AtBerth_kg', 'Substance')]
grid_emissions = grid_emissions %>%
group_by(GRID_ID0, Substance) %>%
summarise(sailing = sum(Sailing_kg, na.rm = TRUE),
berth = sum(AtBerth_kg, na.rm = TRUE))
mapview(grid_emissions[grid_emissions$Substance == 'N2O','sailing'], map.types = c("OpenStreetMap.BlackAndWhite"))
grid_emissions <- grid_emissions[grid_emissions$Substance == 'N2O',]
#Empty raster
r  <- raster(ext =  extent(grid_emissions),
res =  1000,
crs =  ukgrid,
vals = NA)
plot(r)
plot(grid_emissions[grid_emissions$Substance == 'N2O','sailing'], add=T)
plot(grid_emissions)
mapview(grid_emissions[grid_emissions$Substance == 'N2O',])
test <- grid_emissions[grid_emissions$Substance == 'N2O',]
gridded(test) <- TRUE
test <- as(test, 'Spatial')
test
gridded(test) <- TRUE
grid_emissions  <- SpatialPointsDataFrame(grid_emissions, grid_emissions@data)
